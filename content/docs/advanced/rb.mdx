---
title: Runbook
description: Spry Runbook commands for managing and executing tasks in Markdown documents
---

import { Tabs, Tab } from 'fumadocs-ui/components/tabs';
import { Callout } from 'fumadocs-ui/components/callout';
import { Step, Steps } from 'fumadocs-ui/components/steps';

## Overview

Spry Runbook provides commands for discovering, validating, and executing tasks defined as code cells in Markdown documents. This guide covers the essential commands for working with runbooks.

## Command Reference

| Command | Purpose | Executes |
|---------|---------|----------|
| `spry rb ls` | List all tasks | None (informational) |
| `spry rb task <id>` | Execute one task | Target + all dependencies |
| `spry rb run` | Execute all tasks | All tasks in DAG order |
| `spry rb issues` | Find errors | None (validation only) |
| `spry rb report` | Execute and report | All tasks, generates markdown |

---

## spry rb ls

List all executable code cells (tasks) defined in Markdown documents without executing them.

### Syntax

```bash
spry rb ls [paths...]
```

**Parameters:**
- `[paths...]` - Optional markdown file paths (e.g., `Spryfile.md`, `*.md`)

### Usage

<Tabs items={['Default', 'Specific File', 'Multiple Files', 'All Markdown']}>
  <Tab value="Default">
    ```bash
    spry rb ls
    ```
    Lists tasks in the current Spryfile.
    
    **Output:**
    ```
    setup-env
    fetch-data
    validate-data
    transform-data
    ```
  </Tab>
  
  <Tab value="Specific File">
    ```bash
    spry rb ls Spryfile.md
    ```
  </Tab>
  
  <Tab value="Multiple Files">
    ```bash
    spry rb ls Spryfile.md workflow.md pipeline.md
    ```
  </Tab>
  
  <Tab value="All Markdown">
    ```bash
    spry rb ls *.md
    ```
  </Tab>
</Tabs>

### Verbose Output

```bash
spry rb ls -v
```

Includes additional details:
- Task name
- Code block language (bash, sql, python, etc.)
- Description
- Dependencies
- Graph assignment (if any)
- Line number in file

### Common Use Cases

| Use Case | Command |
| --- | --- |
| Discover available tasks | `spry rb ls` |
| Check task order before running | `spry rb ls` then `spry rb run` |
| Find specific task | `spry rb ls \| grep task-name` |
| Validate workflow structure | `spry rb ls` then `spry rb issues` |
| Document available operations | `spry rb ls > tasks.txt` |

---

## spry rb task

Execute a specific cell/task and all its dependencies from Markdown documents. The command automatically runs all upstream dependencies in the correct order.

### Syntax

```bash
spry rb task <taskId> [paths...]
```

**Parameters:**

| Parameter | Description | Required | Example |
|-----------|-------------|----------|---------|
| `<taskId>` | Name/ID of the task to execute | Yes | `task-1`, `validate-data`, `generate-report` |
| `[paths...]` | Markdown file paths to search | No | `Spryfile.md`, `*.md` |

<Callout type="info">
If no file path is specified, the command searches the current directory.
</Callout>

### Options

#### `--verbose <style>`

Emit detailed information messages during execution.

**Styles:**
- `plain` - Plain text output
- `rich` - Colorized/formatted output
- `markdown` - Markdown formatted output

```bash
spry rb task task-1 --verbose rich
```

#### `--summarize`

Emit execution summary in JSON format after task completion.

```bash
spry rb task task-1 --summarize
```

**Example Output:**
```json
{
  "taskId": "task-1",
  "status": "success",
  "duration": "0.234s",
  "output": "Task-1 ran successfully",
  "dependencies": []
}
```

### Usage Examples

#### Basic Execution

<Tabs items={['Single Task', 'With File', 'With Dependencies']}>
  <Tab value="Single Task">
    ```bash
    spry rb task task-1
    ```
    
    **Output:**
    ```
    Task-1 ran successfully
    ```
  </Tab>
  
  <Tab value="With File">
    ```bash
    spry rb task validate-data Spryfile.md
    ```
  </Tab>
  
  <Tab value="With Dependencies">
    ```bash
    spry rb task generate-report
    ```
    
    Automatically runs:
    1. setup-env
    2. fetch-data
    3. validate-data
    4. transform-data
    5. aggregate-metrics
    6. generate-report
  </Tab>
</Tabs>

#### Verbose Output Styles

<Tabs items={['Rich', 'Plain', 'Markdown']}>
  <Tab value="Rich">
    ```bash
    spry rb task task-1 --verbose rich
    ```
    
    **Output:**
    ```
    ┌─ Task Execution ─────────────────────┐
    │ Task: task-1                         │
    │ Status: Running...                   │
    │ Dependencies: None                   │
    └──────────────────────────────────────┘
    ✓ Task-1 ran successfully
    Execution time: 0.125s
    ```
  </Tab>
  
  <Tab value="Plain">
    ```bash
    spry rb task validate-data --verbose plain
    ```
    
    **Output:**
    ```
    Task: validate-data
    Status: Running
    Validation passed
    Execution time: 0.089s
    ```
  </Tab>
  
  <Tab value="Markdown">
    ```bash
    spry rb task transform-data --verbose markdown
    ```
    
    **Output:**
    ```markdown
    ## Task: transform-data

    **Status:** Success  
    **Duration:** 0.156s  
    **Output:** Transformation complete

    ### Dependencies Executed
    - setup-env
    - fetch-data
    - validate-data
    ```
  </Tab>
</Tabs>

#### Combined Options

```bash
spry rb task generate-report Spryfile.md --verbose rich --summarize
```

### Key Concepts

<Callout>
**Automatic Dependency Resolution**: All upstream dependencies execute in order automatically. If a dependency fails, the target task will not execute.
</Callout>

**Task ID**: The name of the code block (e.g., `task-1`, `validate-data`)

**Dependencies**: Tasks that must complete before the target task runs

**Execution Order**: Tasks run in dependency order (DAG)

### Error Handling

#### Task Not Found

```bash
spry rb task nonexistent-task
```

**Error:**
```
Error: Task 'nonexistent-task' not found in any markdown files
```

#### Dependency Failure

<Callout type="error">
If a dependency fails, the task will not execute.
</Callout>

```bash
spry rb task generate-report
```

If `validate-data` fails:
```
Error: Dependency 'validate-data' failed
Task 'generate-report' not executed
```

#### File Not Found

```bash
spry rb task task-1 nonexistent.md
```

**Error:**
```
Error: File 'nonexistent.md' not found
```

---

## Common Workflows

### Discovery and Testing

<Steps>
  <Step>
    ### List available tasks
    ```bash
    spry rb ls
    ```
  </Step>
  
  <Step>
    ### Check for issues
    ```bash
    spry rb issues
    ```
  </Step>
  
  <Step>
    ### Test specific task
    ```bash
    spry rb task validate-data --verbose rich
    ```
  </Step>
  
  <Step>
    ### Run all tasks
    ```bash
    spry rb run
    ```
  </Step>
</Steps>

### Development Workflow

<Steps>
  <Step>
    ### Test single task
    ```bash
    spry rb task task-1
    ```
  </Step>
  
  <Step>
    ### Test with verbose output
    ```bash
    spry rb task task-1 --verbose rich
    ```
  </Step>
  
  <Step>
    ### Get execution summary
    ```bash
    spry rb task task-1 --verbose rich --summarize
    ```
  </Step>
</Steps>

### Production Execution

```bash
# Execute complex task with full logging
spry rb task generate-report --verbose rich --summarize
```

---

## Best Practices

<Callout type="tip">
**Tips for Effective Runbook Usage**

- **Always specify task ID** when using `spry rb task` - it's required
- **Use --verbose for debugging** to see detailed execution flow
- **Use --summarize for automation** to get JSON output for logging
- **List tasks first** with `spry rb ls` before execution
- **File path is optional** - defaults to current directory
- **Dependencies run automatically** - no need to execute them separately
- **Check for issues** with `spry rb issues` before running workflows
</Callout>

---

## Quick Reference

### Discover Tasks
```bash
spry rb ls                    # List all tasks
spry rb ls -v                 # List with details
spry rb ls *.md               # List from all markdown files
```

### Execute Tasks
```bash
spry rb task <taskId>                           # Run task + dependencies
spry rb task <taskId> --verbose rich            # Run with rich output
spry rb task <taskId> --summarize               # Run with JSON summary
spry rb task <taskId> --verbose rich --summarize # Full logging
```

### Validate and Document
```bash
spry rb issues                # Check for errors
spry rb ls > tasks.txt        # Document tasks
```